(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{1274:function(t,s,a){"use strict";a.r(s);var n=a(17),e=Object(n.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[n("router-link",{attrs:{to:"/Coding/Website/vue-dotnetcore-scaffolding/authentication.html"}},[t._v("承接上篇")]),t._v("，建立了一個"),n("code",[t._v("Cookie-Based")]),t._v("的認證方式")],1),t._v(" "),n("p",[t._v("這回要做的是網頁的閒置登出機制")]),t._v(" "),n("p",[t._v("網頁的閒置登出機制可以很簡單、很單純，也可以非常的複雜")]),t._v(" "),n("p",[t._v("比較簡單來說，大概就是登入後放置個幾秒就把你登出")]),t._v(" "),n("h1",{attrs:{id:"需求"}},[t._v("需求")]),t._v(" "),n("p",[t._v("而以下是這次要來挑戰的目標")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("閒置10分鐘要跳"),n("code",[t._v("閒置警告")])])]),t._v(" "),n("li",[n("p",[n("code",[t._v("閒置警告")])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("倒數1分鐘後觸發"),n("code",[t._v("強制登出")])])]),t._v(" "),n("li",[n("p",[n("code",[t._v("閒置警告")]),t._v("可以跳出來2次")])]),t._v(" "),n("li",[n("p",[t._v("當第3次閒置時，觸發"),n("code",[t._v("強制登出")])])])])]),t._v(" "),n("li",[n("p",[n("code",[t._v("強制登出")])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("要跳到首頁")])]),t._v(" "),n("li",[n("p",[t._v("要顯示提示訊息，讓user按下確定才會關")])])])]),t._v(" "),n("li",[n("p",[n("em",[n("strong",[t._v("閒置登出機制要跨瀏覽器分頁")])])])]),t._v(" "),n("li",[n("p",[n("em",[n("strong",[t._v("閒置登出機制要能在手機上作用")])])])])]),t._v(" "),n("p",[t._v("完成後的demo如下:")]),t._v(" "),n("ul",[n("li",[t._v("在示意影片中:\n"),n("ul",[n("li",[t._v("閒置10分鐘調整成閒置3秒鐘")]),t._v(" "),n("li",[t._v("閒置警告倒數1分鐘調整成5秒鐘")])])])]),t._v(" "),n("p",[n("video",{attrs:{controls:"",preload:"metadata"}},[n("source",{attrs:{type:"video/mp4",src:a(838)}}),t._v("\nYour browser does not support playing HTML5 video. You can "),n("a",{attrs:{href:"./img-page-idle/page-idle(2020-11-16).mp4",download:""}},[t._v("download a copy of the video file")]),t._v(" instead.\n")])]),t._v(" "),n("h1",{attrs:{id:"需求分析"}},[t._v("需求分析")]),t._v(" "),n("h2",{attrs:{id:"baseline"}},[t._v("Baseline")]),t._v(" "),n("p",[t._v("首先，當在桌電上，且單一網頁的情況下，條件1~3其實還算是單純的")]),t._v(" "),n("p",[t._v("直觀上來說，可以做個2層的巢狀Timeout，在配合上user停止動作後去觸發第一層Timeout來進行實作")]),t._v(" "),n("p",[t._v("以下是概略架構:")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("Timer1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    Timer2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 執行強制登出")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 倒數1分鐘")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 倒數10分鐘")]),t._v("\n")])])]),n("p",[t._v("接著搭配事件綁定來觸發RunTimer1")]),t._v(" "),n("p",[t._v("每次執行RunTimer1時，都先把Timer1給清掉")]),t._v(" "),n("p",[t._v("這樣就能做到user有動作就重新計算閒置時間的功能")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("RunTimer1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("clearInterval")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Timer1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    Timer1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// js沒有這個指令，這邊只是示意")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" unidleEvents "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mousemove click mouseup mousedown keydown keypress keyup submit change mouseenter scroll resize dblclick"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("bind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("unidleEvents"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" RunTimer1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("而以上的事件綁定我們可以用 "),n("code",[t._v("throttle")]),t._v(" 來改善效能")]),t._v(" "),n("p",[t._v("如果不進行改善的話，光是滑鼠的移動，就會觸發非常多次的 RunTimer1")]),t._v(" "),n("p",[t._v("而加上 "),n("code",[t._v("throttle")]),t._v(" 的話，則可以讓指定的function在一定時間內只被執行一次 "),n("sup",{staticClass:"footnote-ref"},[n("a",{attrs:{href:"#fn1",id:"fnref1"}},[t._v("[1]")])])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("bind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("unidleEvents"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("throttle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RunTimer1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h3",{attrs:{id:"問題點"}},[t._v("問題點")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("多分頁")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("問題")]),t._v(" "),n("p",[t._v("很顯然的，當多分頁的情況下，光是閒置倒數的時間就會不同")]),t._v(" "),n("p",[t._v("畢竟 RunTimer1 會在不同的時間點被啟動")])]),t._v(" "),n("li",[n("p",[t._v("解法")]),t._v(" "),n("p",[t._v("為了同步跨分頁的Timer，可以利用 "),n("code",[t._v("localStorage")]),t._v(" 來進行資料的儲存")]),t._v(" "),n("p",[t._v("並利用 Vue 響應式的機制來觸發主要邏輯")])])])]),t._v(" "),n("li",[n("p",[t._v("手機")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("問題")]),t._v(" "),n("p",[t._v("若 User 使用手機進行瀏覽時，若完成登入後，看沒多久，就使用其他APP")]),t._v(" "),n("p",[t._v("那網頁上的Timer，由於手機效能考量的設計，Timer是不會繼續倒數計時的")]),t._v(" "),n("p",[t._v("因此如果現在是倒數50秒跳出，當 User 切換到其他APP使用了100秒後回到網頁")]),t._v(" "),n("p",[t._v("那網頁上的時間還是會在50秒")])]),t._v(" "),n("li",[n("p",[t._v("解法")]),t._v(" "),n("p",[t._v("將 "),n("code",[t._v("setTimeout")]),t._v(" 改成 "),n("code",[t._v("setInterval")]),t._v(" 並且當 User 開始閒置時，設置一個"),n("code",[t._v("初始時間點")])]),t._v(" "),n("p",[t._v("讓 interval 不斷地用現在的時間跟"),n("code",[t._v("初始時間點")]),t._v("做計算")]),t._v(" "),n("p",[t._v("這樣當 User 從其他 app 切回來時，時間的計算就會對上了")])])])]),t._v(" "),n("li",[n("p",[t._v("極端一點來說")]),t._v(" "),n("p",[t._v("若在電腦上剛完成登入就關掉分頁，一個小時候重新開啟這個分頁，那麼理論上應該要直接登出")]),t._v(" "),n("p",[t._v("但如果用 "),n("code",[t._v("setTimeout")]),t._v(" 的方式，將可能會變成僅觸發 "),n("code",[t._v("閒置警告")]),t._v("，或者還在偵測閒置時間，連"),n("code",[t._v("閒置警告")]),t._v("都不會跳出")])])]),t._v(" "),n("h2",{attrs:{id:"nested-interval-approach"}},[t._v("Nested Interval Approach")]),t._v(" "),n("p",[t._v("綜合以上，若以 Baseline 中，巢狀 Timeout 為基礎，用 "),n("code",[t._v("setInterval")]),t._v(" 來進行改造:")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" startTimestamp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nTimer1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setInterval")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" startTimestamp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 倒數10分鐘")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("clearInterval")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Timer1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    startTimestamp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    Timer2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setInterval")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" startTimestamp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 倒數1分鐘")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("clearInterval")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Timer2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 執行強制登出")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h3",{attrs:{id:"問題點-2"}},[t._v("問題點")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("最明顯的地方在於，沒有使用 "),n("code",[t._v("localStorage")]),t._v(" 因此時間變數還是沒辦法跨分頁共享")])]),t._v(" "),n("li",[n("p",[t._v("再來還有一個問題，當網頁進入"),n("code",[t._v("閒置警告")]),t._v("時，若時間變數已經從 "),n("code",[t._v("localStorage")]),t._v(" 中得到同步")]),t._v(" "),n("p",[t._v("這時如果開新的分頁進入網頁，那新的網頁會優先進入 Timer1 這時如果內部的邏輯沒處理好")]),t._v(" "),n("p",[t._v("將可能導致新的分頁不會進入"),n("code",[t._v("閒置警告")]),t._v("的畫面")])])]),t._v(" "),n("h2",{attrs:{id:"reactive-interval-approach"}},[t._v("Reactive Interval Approach")]),t._v(" "),n("p",[t._v("其實以上的Approach遇到很多狀況都需要作出很複雜的處理")]),t._v(" "),n("p",[t._v("比方說登出時Timer要停掉，登入時Timer要啟動，多分頁資料的同步也是個大學問")]),t._v(" "),n("p",[t._v("因此為了讓各種狀況變得比較好應對，我採用響應式的方式來進行實作，基本理念如下")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("將 Vuex store 改成儲存在 localStorage")]),t._v(" "),n("p",[t._v("這樣就可能在開發時正常操作 store，然後利用 store.commit 來同步資料到 localStorage")])]),t._v(" "),n("li",[n("p",[t._v("將閒置次數區分成 local 與 golbal(存在localStorage)")]),t._v(" "),n("p",[t._v("由於閒置3次要"),n("code",[t._v("強制登出")]),t._v("，那就必須要有個變數紀錄目前閒置幾次")]),t._v(" "),n("p",[t._v("如果每次觸發"),n("code",[t._v("閒置警告")]),t._v("，每個分頁都幫 localStorage 中的"),n("code",[t._v("閒置次數")]),t._v("+1")]),t._v(" "),n("p",[t._v("那有幾個分頁就會增加幾次，那樣次數就會亂掉了")]),t._v(" "),n("p",[t._v("因此，在閒置次數的判斷上，可以用 local 的閒置次數進行判斷")]),t._v(" "),n("p",[t._v("當網頁第一次載入時，從localStorage將值assign到local閒置次數中")]),t._v(" "),n("p",[t._v("當確定要增加次數時，先幫自己+1，接著用 assign 的方式塞到 localStorage")]),t._v(" "),n("p",[t._v("這樣不管assign幾次，localStorage中的值都不會被重複增加")])]),t._v(" "),n("li",[n("p",[t._v("設定閒置狀態")]),t._v(" "),n("div",{staticClass:"language-ts extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("enum")]),t._v(" IdleDetermineStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ByPass"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不須使用閒置登出狀態")]),t._v("\n    PageIdle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 要觀察網頁是否閒置")]),t._v("\n    UserComfirm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 要進行閒置警告的倒數")]),t._v("\n    Logout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 執行登出的動作")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("設置一個 Interval")]),t._v(" "),n("p",[t._v("使用一個 Interval ，在網頁載入後就啟動不停止")]),t._v(" "),n("p",[t._v("並根據現在的閒置狀態來進行時間的計算，以及狀態的轉移")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" intervalRunner "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setInterval")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("store"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pageIdle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("idleDetermineStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" IdleDetermineStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PageIdle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          passSeconds "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 閒置秒數\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" passSeconds "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" idleSeconds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetIdleDetermineStates")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IdleDetermineStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UserComfirm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" IdleDetermineStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UserComfirm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          remainUserComfirmSeconds "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 倒數計時秒數\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" remainUserComfirmSeconds "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetIdleDetermineStates")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IdleDetermineStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Logout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" IdleDetermineStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Logout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetIdleDetermineStates")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IdleDetermineStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ByPass"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" IdleDetermineStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ByPass"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("250")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("設置 watcher 以應對閒置狀態的改變")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("watch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" store"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pageIdle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("idleDetermineStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("newStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" IdleDetermineStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" IdleDetermineStates")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStates "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" IdleDetermineStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PageIdle "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" \n            newStates "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" IdleDetermineStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UserComfirm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddIdleTimes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" idleRemainTimes "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetIdleDetermineStates")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IdleDetermineStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Logout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetIsShowUserConfirm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  \n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStates "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" IdleDetermineStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UserComfirm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" \n            newStates "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" IdleDetermineStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Logout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Logout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetIsShowLogOutNotification")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("Assign 計算時間點")]),t._v(" "),n("p",[t._v("當 User 有在使用網頁時，就同步紀錄閒置時間的起始時間點 & 閒置警告的起始時間點")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetTimeStamp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" startIdleTimestamp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" startUserConfirmTimestamp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("startIdleTimestamp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTime")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" props"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("idleSeconds "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("250")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    store"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("commit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pageIdle/SetStartIdleTimestamp"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" startIdleTimestamp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    store"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("commit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pageIdle/SetStartUserConfirmTimestamp"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" startUserConfirmTimestamp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("PageIdleHandler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" store"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pageIdle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("idleDetermineStates "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" IdleDetermineStates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PageIdle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetTimeStamp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("bind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("unidleEvents"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("throttle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("PageIdleHandler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),n("h1",{attrs:{id:"安裝套件"}},[t._v("安裝套件")]),t._v(" "),n("p",[t._v("為了達成以上的需求，以下是這次所安裝的套件")]),t._v(" "),n("h2",{attrs:{id:"vuex-multi-tab-state"}},[t._v("vuex-multi-tab-state")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -D vuex-multi-tab-state\n")])])]),n("p",[t._v("透過在 plugins 中進行註冊，就能直接讓 store 裡的資料儲存在 localStorage 中")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" createStore "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vuex'")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" createMultiTabState "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vuex-multi-tab-state'")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createStore")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  mutations"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  actions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  modules"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  plugins"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createMultiTabState")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("但在使用上有幾個地方要小心")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("型別")]),t._v(" "),n("p",[t._v("由於 localStorage 中只能儲存字串，因此在拿取資料時，比方說 Date Type 的資料時，要進行轉型一下會比較保險")])]),t._v(" "),n("li",[n("p",[t._v("更新機制")]),t._v(" "),n("p",[t._v("有時為了方便，會使用 "),n("code",[t._v("store.state.variable = something")]),t._v(" 的方式來異動資料")]),t._v(" "),n("p",[t._v("但這樣的寫法會無法使 "),n("code",[t._v("vuex-multi-tab-state")]),t._v(" 同步更新 localStorage")]),t._v(" "),n("p",[t._v("必須使用 mutation 的方式，套件才能將資料進行同步")])])]),t._v(" "),n("h2",{attrs:{id:"jquery"}},[t._v("jquery")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -D jquery\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -D @types/jquery // 由於有使用到 typescript ，因此要再安裝他的一些定義\n")])])]),n("h2",{attrs:{id:"lodash"}},[t._v("lodash")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -D lodash.debounce\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -D @types/lodash.debounce\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -D lodash.throttle\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -D @types/lodash.throttle\n")])])]),n("h2",{attrs:{id:"vue-toastification"}},[t._v("vue-toastification")]),t._v(" "),n("p",[t._v("用來進行登出時，右上跳出通知的處理")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -D vue-toastification@next\n")])])]),n("h2",{attrs:{id:"material-design-icons"}},[t._v("material-design-icons")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -D material-design-icons\n")])])]),n("h2",{attrs:{id:"animate-css"}},[t._v("animate.css")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -D animate.css\n")])])]),n("h1",{attrs:{id:"前後端閒置狀態連動機制"}},[t._v("前後端閒置狀態連動機制")]),t._v(" "),n("p",[t._v("如果前端 User 一直使用，卻剛好都沒有呼叫到後端的功能的話，後端是有可能自己閒置登出的")]),t._v(" "),n("p",[t._v("因此可以設置一個 "),n("code",[t._v("KeepAlive()")]),t._v(" 確定 User 有在動作後，每隔30秒就呼叫一次後端，來避免後端自己閒置登出")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("後端部分")]),t._v(" "),n("div",{staticClass:"language-csharp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-csharp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// <summary>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// for refreshing session")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// </summary>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// <returns></returns>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpPost")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ActionResult")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("KeepAlive")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ok")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("前端部分")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("bind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("unidleEvents "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("debounce")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("KeepAlive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("關於 debounce 可以參考 "),n("sup",{staticClass:"footnote-ref"},[n("a",{attrs:{href:"#fn1",id:"fnref1:1"}},[t._v("[1:1]")])])])])]),t._v(" "),n("h1",{attrs:{id:"測試"}},[t._v("測試")]),t._v(" "),n("p",[t._v("雖然"),n("a",{attrs:{href:"#%E9%9C%80%E6%B1%82"}},[t._v("需求")]),t._v("的描述只有少少的幾行，跟5個列點，但實際上，第4跟第5點一加下去")]),t._v(" "),n("p",[t._v("WOW，要測的edge case就不少了，這邊就先簡單條列一些狀況:")]),t._v(" "),n("ol",[n("li",[t._v("開多個分頁，登入後閒置，每個分頁要一起跳出閒置警告畫面")]),t._v(" "),n("li",[t._v("使用過程中若不斷 F5，狀態不能錯(閒置次數要對、閒置狀態要對 ...)")]),t._v(" "),n("li",[t._v("在閒置警告畫面出現時開新分頁，要能夠正確顯示閒置警告畫面")]),t._v(" "),n("li",[t._v("登入後就關掉網頁，過了閒置時間+等待確認時間後再重新打開分頁，應該要登出")]),t._v(" "),n("li",[t._v("用手機時，用一半跑去用其他app後再回來，時間跟狀態的計算要對")])]),t._v(" "),n("h1",{attrs:{id:"總結來說"}},[t._v("總結來說")]),t._v(" "),n("p",[t._v("由於資料會異步更新，因此非常的考驗開發時頭腦的清晰度，否則狀態很容易就弄錯了")]),t._v(" "),n("p",[t._v("再來，開發時能避免巢狀還是儘量避免得好，對腦細胞來說比較友善一點(?")]),t._v(" "),n("p",[t._v("雖然處理多工的難度比較大，但實作出來後的成就感也是滿大的")]),t._v(" "),n("p",[t._v("以上就是一個小小的閒置登出機制，"),n("a",{attrs:{href:"https://github.com/Jchou24/vue3-donetcore3-spa-page-idle-template",target:"_blank",rel:"noopener noreferrer"}},[t._v("完整的Code在此"),n("OutboundLink")],1),t._v(" 歡迎參考看看啦")]),t._v(" "),n("hr",{staticClass:"footnotes-sep"}),t._v(" "),n("section",{staticClass:"footnotes"},[n("ol",{staticClass:"footnotes-list"},[n("li",{staticClass:"footnote-item",attrs:{id:"fn1"}},[n("p",[t._v("關於 "),n("code",[t._v("throttle")]),t._v(", "),n("code",[t._v("debounce")]),t._v(" 可以到"),n("a",{attrs:{href:"http://demo.nimius.net/debounce_throttle/",target:"_blank",rel:"noopener noreferrer"}},[t._v("這個網站"),n("OutboundLink")],1),t._v("來玩玩看，應該會更有感覺 "),n("a",{staticClass:"footnote-backref",attrs:{href:"#fnref1"}},[t._v("↩︎")]),t._v(" "),n("a",{staticClass:"footnote-backref",attrs:{href:"#fnref1:1"}},[t._v("↩︎")])])])])])])},[],!1,null,null,null);s.default=e.exports},838:function(t,s,a){t.exports=a.p+"assets/media/page-idle(2020-11-16).45ce86f5.mp4"}}]);